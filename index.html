<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PlayRank Games</title>
<style>
* {margin:0; padding:0; box-sizing:border-box; font-family:sans-serif;}
body {background:#f4f4f4; color:#333; line-height:1.6;}
nav {display:flex; justify-content: space-between; align-items:center; background:#222; color:#fff; padding:10px 20px;}
nav .logo {font-size:24px; font-weight:bold;}
nav ul {list-style:none; display:flex; gap:15px;}
nav ul li a {color:#fff; text-decoration:none;}
.hero {padding:40px 20px; text-align:center; background:#333; color:#fff;}
.hero input[type="text"] {padding:10px; width:80%; max-width:400px; margin-top:20px; border:none; border-radius:5px;}
main {padding:20px;}
section {margin-bottom:40px;}
.game-card {background:#fff; margin-bottom:15px; padding:15px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.game-card h3 {margin-bottom:10px; display:flex; align-items:center;}
.game-card h3 img {height:30px; margin-right:10px;}
.rating, .avg-stars {margin-top:10px;}
.star {font-size:20px; color:#ccc; cursor:pointer;}
.star.selected {color:gold;}
.star.avg {cursor:default;}
footer {text-align:center; padding:20px; margin-top:40px; background:#222; color:#ddd;}
</style>
</head>
<body>
<nav>
  <div class="logo">PlayRank Games</div>
  <ul>
    <li><a href="#picks">PlayRank Games Picks</a></li>
  </ul>
</nav>

<header class="hero">
  <h1>PlayRank Games — Rate Your Favorite Games</h1>
  <p>Community-driven ratings for top games. Search for your favorites below.</p>
  <input type="text" id="search" placeholder="Search Over 500 Games..." />
</header>

<main>
  <section id="search-results">
    <!-- Search results appear here -->
  </section>

  <section id="picks">
    <h2>PlayRank Games Picks</h2>
    <!-- Top 10 picks rendered here -->
  </section>
</main>

<footer>
  &copy; 2025 PlayRank Games — Community Game Ratings
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, runTransaction, onValue, off } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCElu0rPnRHfd3ocbzBCyvZcuCnjkz9-Xo",
  authDomain: "playrank-games.firebaseapp.com",
  projectId: "playrank-games",
  storageBucket: "playrank-games.firebasestorage.app",
  messagingSenderId: "856773881474",
  appId: "1:856773881474:web:1f684733880bbbe96c4e9b",
  measurementId: "G-39MPF1BWMC",
  databaseURL: "https://playrank-games-default-rtdb.firebaseio.com/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Prevent multiple votes per device
let votedLocal = JSON.parse(localStorage.getItem("votedLocal")) || {};
function saveLocal() { localStorage.setItem("votedLocal", JSON.stringify(votedLocal)); }

// --- Game Arrays ---
const picks = [
  {name:"GTA 5", logo:"https://logos-world.net/wp-content/uploads/2021/02/GTA-5-Symbol.png"},
  {name:"Minecraft", logo:"https://logos-world.net/wp-content/uploads/2020/04/Minecraft-Logo.png"},
  {name:"Roblox", logo:"https://archive.org/download/app-icon-roblox/app-icon-roblox.png"},
  {name:"Fifa 25", logo:"https://www.fifaultimateteam.it/wp-content/uploads/2024/07/cover-logo-black-fc-25.webp"},
  {name:"War Thunder", logo:"https://www.vhv.rs/dpng/f/390-3904724_war-thunder-png.png"},
  {name:"Geometry Dash", logo:"https://logos-world.net/wp-content/uploads/2022/05/Geometry-Dash-Logo.png"},
  {name:"Among Us", logo:"https://logodix.com/logo/2207096.png"},
  {name:"Mario Kart", logo:"https://logos-world.net/wp-content/uploads/2024/02/Mario-Kart-Logo-2005.png"},
  {name:"Kingdom Hearts 3", logo:"https://purepng.com/public/uploads/large/purepng.com-kingdom-hearts-3-logokingdom-heartsgamefantasythreesquare-enixdisney-21528619495uvx4u.png"},
  {name:"Super Smash Bros", logo:"https://logos-world.net/wp-content/uploads/2022/01/Super-Smash-Bros.-Logo-2014.png"}
];

// --- FULL GAME LIST for search ---
const allGames = [
"Minecraft","Roblox","GTA V","Fifa 25","War Thunder","Geometry Dash","Among Us","Mario Kart","Kingdom Hearts 3","Super Smash Bros","Fortnite","Call of Duty: Warzone","Apex Legends","The Sims 4","Stardew Valley","Animal Crossing: New Horizons","Terraria","League of Legends","Valorant","Overwatch","PUBG","FIFA 23","Rocket League","Genshin Impact","The Witcher 3: Wild Hunt","Red Dead Redemption 2","Assassin's Creed Valhalla","Cyberpunk 2077","Fall Guys","Dead by Daylight","Phasmophobia","Subnautica","Baldur's Gate 3","Diablo IV","Diablo II","World of Warcraft","Hearthstone","Dota 2","Counter-Strike: Global Offensive","Team Fortress 2","Skyrim","Fallout 4","Fallout: New Vegas","Black Desert Online","Destiny 2","Monster Hunter: World","Elden Ring","Hollow Knight","Cuphead","Hades","Celeste","Ori and the Will of the Wisps","Undertale","Ark: Survival Evolved","Don't Starve","Don't Starve Together","Rust","Sea of Thieves","No Man's Sky","Star Wars Jedi: Fallen Order","Borderlands 3","Borderlands 2","Borderlands","Mafia: Definitive Edition","Mafia II","Mafia III","Dead Space","Dead Space 2","Dead Space 3","Resident Evil 2","Resident Evil 3","Resident Evil 4","Resident Evil 7","Resident Evil Village","Silent Hill 2","Silent Hill 3","Silent Hill 4","Tomb Raider","Rise of the Tomb Raider","Shadow of the Tomb Raider","Prince of Persia: The Sands of Time","Prince of Persia: Warrior Within","Prince of Persia: The Two Thrones","God of War","God of War II","God of War III","God of War (2018)","Horizon Zero Dawn","Horizon Forbidden West","Sekiro: Shadows Die Twice","Nioh","Nioh 2","Dark Souls","Dark Souls II","Dark Souls III","Demon's Souls","Bloodborne","Monster Hunter Rise","Fire Emblem: Three Houses","Animal Crossing: Pocket Camp","Pokémon GO","Pokémon Sword","Pokémon Shield","Pokémon Brilliant Diamond","Pokémon Shining Pearl","Pokémon Legends: Arceus","Pokémon Scarlet","Pokémon Violet","Candy Crush Saga","Clash of Clans","Clash Royale","Brawl Stars","Mobile Legends","Subway Surfers","Temple Run","Angry Birds","Fruit Ninja","Beat Saber","Super Mario Odyssey","Super Mario Galaxy","Super Mario 64","Super Mario Sunshine","Mario Kart 8 Deluxe","Mario Kart Wii","Mario Kart 7","Mario Party","Luigi’s Mansion 3","Splatoon 2","Splatoon 3","Metroid Dread","Metroid Prime","Metroid Prime 2","Metroid Prime 3","Metroid Fusion","Donkey Kong Country: Tropical Freeze","Donkey Kong Country Returns","Kirby Star Allies","Kirby’s Epic Yarn","Star Fox 64","Star Fox Adventures","Star Fox Zero","F-Zero GX","Pikmin","Pikmin 2","Pikmin 3","Pikmin 4","Animal Crossing: City Folk","Animal Crossing: Wild World","Animal Crossing: New Leaf","Fire Emblem: Awakening","Fire Emblem Fates","Fire Emblem Echoes","Super Smash Bros Ultimate","Super Smash Bros Melee","Super Smash Bros Brawl","Super Smash Bros for 3DS/Wii U","Tekken 7","Tekken 6","Street Fighter V","Street Fighter IV","Street Fighter III","Mortal Kombat 11","Mortal Kombat X","Mortal Kombat 9","Injustice 2","Injustice: Gods Among Us","Soulcalibur VI","Soulcalibur V","Guilty Gear Strive","Gran Turismo 7","Gran Turismo 6","Gran Turismo 5","Forza Horizon 5","Forza Horizon 4","Forza Motorsport 7","Forza Motorsport 6","NBA 2K23","NBA 2K22","NBA 2K21","NBA 2K20","FIFA 22","FIFA 21","FIFA 20","FIFA 19","Madden NFL 23","Madden NFL 22","Madden NFL 21","Madden NFL 20"
];

// Sort alphabetically
allGames.sort((a,b)=>a.localeCompare(b));

// --- Build a card ---
function createCard(name, logo=null) {
  const card = document.createElement("div");
  card.className = "game-card";
  const id = name.replace(/\s+/g,"");

  card.innerHTML = `
    <h3>${logo ? `<img src="${logo}" />` : ""}${name}</h3>
    <div class="avg-stars" id="avg-${id}"></div>
    <div class="rating" id="rate-${id}"></div>
  `;

  const ratingDiv = card.querySelector(`#rate-${id}`);

  if (!votedLocal[name]) {
    for (let i=1;i<=10;i++) {
      const s = document.createElement("span");
      s.className="star";
      s.textContent="★";
      s.dataset.value=i;
      s.onclick = async () => {
        if (votedLocal[name]) return;
        votedLocal[name] = true;
        saveLocal();
        const gameRef = ref(db,"ratings/"+name);
        try {
          await runTransaction(gameRef,current=>{
            if (!current) return {avg:i,count:1};
            const newCount = (current.count||0)+1;
            const currentAvg = parseFloat(current.avg||0);
            const newAvg = ((currentAvg*(current.count||0))+i)/newCount;
            return {avg:newAvg,count:newCount};
          });
        } catch(err){console.error(err);}
        render();
      };
      ratingDiv.appendChild(s);
    }
  }

  const avgDiv = card.querySelector(`#avg-${id}`);
  const gameRef = ref(db,"ratings/"+name);
  try { off(gameRef); } catch(e){}
  onValue(gameRef,(snap)=>{
    if (!snap.exists()) {
      avgDiv.textContent="No ratings yet";
      return;
    }
    const data = snap.val();
    const avg = parseFloat(data.avg||0);
    const count = data.count||0;
    let stars="";
    for (let j=1;j<=10;j++){
      stars+=`<span class="star avg" style="color:${j<=avg?"gold":"#ccc"}">★</span>`;
    }
    avgDiv.innerHTML=`${stars} <strong>${avg.toFixed(1)}</strong>/10 (${count} vote${count===1?"":"s"})`;
  });

  return card;
}

// --- Render ---
function render() {
  const searchQuery = document.getElementById("search").value.toLowerCase();
  const searchContainer = document.getElementById("search-results");
  searchContainer.innerHTML="";
  if(searchQuery){
    const matched = allGames.filter(g=>g.toLowerCase().includes(searchQuery));
    if(matched.length>0){
      matched.forEach(name=>{
        const pickObj = picks.find(p=>p.name===name);
        const logo = pickObj ? pickObj.logo : null;
        searchContainer.appendChild(createCard(name,logo));
      });
    }
  }

  const picksContainer = document.getElementById("picks");
  picksContainer.innerHTML="<h2>PlayRank Games Picks</h2>";
  picks.forEach(p=>picksContainer.appendChild(createCard(p.name,p.logo)));
}

document.getElementById("search").addEventListener("input",render);
window.addEventListener("DOMContentLoaded",render);

</script>
</body>
</html>
